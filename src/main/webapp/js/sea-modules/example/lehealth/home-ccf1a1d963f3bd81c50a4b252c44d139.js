define("example/lehealth/home",["jquery-mobile/1.4.4/jquery.mobile","./common","highcharts/4.0.3/highcharts-all","jquery","highcharts/4.0.3/highchartsTheme"],function(a,b){function c(a,b,c,d){var e=c+b*Math.cos(2*Math.PI*a/360),f=d+b*Math.sin(2*Math.PI*a/360);return{x:e,y:f}}function d(a,b,d,e){var g=["rgb(120, 210, 90)","rgb(240, 180, 90)","rgb(220, 60, 70)"],h=f(a),i=new Kinetic.Stage({container:"healthInfo",width:document.getElementById("healthInfo").offsetWidth,height:220}),j=new Kinetic.Layer,k=new Kinetic.Arc({x:i.getWidth()/2,y:i.getHeight()/2,innerRadius:i.getHeight()/2-16,outerRadius:i.getHeight()/2,fill:"rgb(120, 210, 90)",angle:110,rotationDeg:110}),l=new Kinetic.Arc({x:i.getWidth()/2,y:i.getHeight()/2,innerRadius:i.getHeight()/2-16,outerRadius:i.getHeight()/2,fill:"rgb(240, 180, 90)",angle:110,rotationDeg:220}),m=new Kinetic.Arc({x:i.getWidth()/2,y:i.getHeight()/2,innerRadius:i.getHeight()/2-16,outerRadius:i.getHeight()/2,fill:"rgb(220, 60, 70)",angle:100,rotationDeg:330});console.info(a);var n=c(a,i.getHeight()/2-26,i.getWidth()/2,i.getHeight()/2),o=c(70,i.getHeight()/2-8,i.getWidth()/2,i.getHeight()/2),p=c(110,i.getHeight()/2-8,i.getWidth()/2,i.getHeight()/2),q=new Kinetic.Circle({x:n.x,y:n.y,radius:10,fill:g[h-1]}),r=new Kinetic.Circle({x:o.x,y:o.y,radius:8,fill:"rgb(220, 60, 70)"}),s=new Kinetic.Circle({x:p.x,y:p.y,radius:8,fill:"rgb(120, 210, 90)"}),b=new Kinetic.Text({x:0,y:60,text:"心率: "+b,fontSize:20,align:"center",width:i.getWidth(),fill:"rgb(160, 160, 160)"}),t=new Kinetic.Text({x:0,y:110,text:d+" / "+e,fontSize:34,fontStyle:"bold",align:"center",width:i.getWidth(),fill:g[h-1]});j.add(k),j.add(l),j.add(m),j.add(q),j.add(r),j.add(s),j.add(b),j.add(t),i.add(j),i.draw()}function e(a,b,c,e){var f=g(a);if(h){var i=g(h);if(h=a,i==f)d(f,b,c,e);else var j=f>i?10:-10,k=i,l=setInterval(function(){k+=j,d(k,b,c,e),k>f&&clearInterval(l)},5)}else h=a,d(f,b,c,e)}function f(a){return a>=110&&220>a?1:a>=220&&330>a?2:a>=330&&430>a?3:void 0}function g(a){var b=0;return 1==a?b=165:2==a?b=275:3==a&&(b=380),b}var h,i=a("jquery-mobile/1.4.4/jquery.mobile"),j=a("./common"),k="/lehealth/api/home/data",l=[];window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,10)}}(),b.render=function(){i.mobile.loading("show",{text:"页面加载中...",textVisible:!0,theme:"c",html:""}),i(document).off("pageshow","#homepage"),i(document).on("pageshow","#homepage",function(){function b(a,b){var c=j.getCookieByKey("loginid"),f=j.getCookieByKey("tk"),g=15;i.ajax({url:k,type:"GET",dataType:"json",async:!0,data:{loginid:c,token:f,days:g,user:a},success:function(c){if(i.mobile.loading("hide"),c.errorcode){if(1==c.errorcode)return j.setCookie("jump","/lehealth/bpmonitor.html"),void i.mobile.changePage("/lehealth/login.html","slide");j.toast("获取数据失败，请刷新界面")}else{if(a=a||"")i("#curuser").text(b);else{i("#ulistwraper").empty(),l=c.result.guardeds||[],l.unshift({username:"我",userid:""});for(var f=0;f<l.length;f++){var h=i('<div class="uitem"></div>');h.attr("userid",l[f].userid),h.text(l[f].username),f==l.length-1&&h.css("border-bottom","none"),h.appendTo("#ulistwraper")}i("#curuser").text("我")}var k=c.result.status,m=c.result.records?c.result.records[c.result.records.length-1]:void 0;m&&e(k,m.heartrate,m.sbp,m.dbp);var n=864e5,o=c.result.records||[],p=c.result.history||[],q=[],r=new Date;console.info(r.getTime()),r.setHours(0),r.setMinutes(0),r.setSeconds(0),r.setMilliseconds(0),console.info(r.getTime());for(var s=r.getTime()-n*g,f=1;g>=f;f++){for(var t=!1,u=0;u<o.length;u++){var v=o[u].date,w=new Date(v);if(w.setHours(0),w.setMinutes(0),w.setSeconds(0),w.setMilliseconds(0),o[u].date=v=w.getTime(),v>=s+f*n&&s+(f+1)*n>v){q.push(o[u]),console.info("bpdate: "+v),t=!0;break}}t||q.push({date:s+f*n,dbp:null,sbp:null,heartrate:null})}for(var x=[],y=[],z=[],A=[],B={},f=0;f<q.length;f++){var C=q[f];x.push(new Date(C.date).getDate()+"日"),console.info("date day:"+C.date+", day: "+new Date(C.date).getDate());{new Date(C.date).getDate()}B[C.date]||(B[C.date]={}),y.push(C.dbp),z.push(C.sbp),A.push(C.heartrate)}console.info(B);for(var D in p){var E=p[D].medicinename,F=new Date(p[D].date);F.setHours(0),F.setMinutes(0),F.setSeconds(0),F.setMilliseconds(0);var G=B[F.getTime()];G&&(G[E]=!0)}console.info(B);var H=[];for(var I in B){var J=B[I],K=[];for(var L in J)K.push(L);H.push({tm:parseInt(I),name:K,day:new Date(parseInt(I)).getDate()})}H.sort(function(a,b){return a.tm-b.tm}),console.info("tmpArr: "),console.info(H);for(var M,N,O=[],P=[],f=0;f<H.length;f++){var Q=H[f],R=H[f+1];if(0==f)var S=H[f].day;M||(M=Q.day-S-.5),R?R&&j.arrayEqual(R.name,Q.name)||(N=Q.day+.5-S,O.push({from:M,to:N,label:{text:Q.name.join("+")},color:"#87CEFF"}),P.push({name:Q.name.join("+"),color:"#87CEFF"}),M=0,N=0):(N=Q.day+.5-S,O.push({from:M,to:N,label:{text:Q.name.join("+")},color:"blue"}),P.push({name:Q.name.join("+"),color:"#87CEFF"}),M=0,N=0)}console.info(O);var T=["#A4D3EE","#B4CDCD","#90EE90","#B4EEB4","#D1D1D1","#CDAA7D","#BCEE68","#EEEE00"];console.info(P);var U={};i("#medicationtips").empty();var V=!1;d.xAxis[0].update({plotBands:[]});for(var f=0;f<O.length;f++)U[O[f].label.text]&&(O[f].color=T[f],P[f].color=T[f]),O[f].color=T[f],P[f].color=T[f],O[f].label.text&&(V=!0,delete O[f].label,i("#medicationtips").append('<div style="height: 20px; line-height: 20px; width: 100%; overflow: auto"><div style="width: 12px; height: 12px; margin: 4px;float:left; background-color: '+P[f].color+'"></div> <div style="float:left; margin-left: 8px; font-size: 12px; width: 80%; overflow: auto">'+P[f].name+'</div><div style="clear:both"></div></div>'),d.xAxis[0].addPlotBand(O[f]));V||i("#medicationtips").append('<div style="height: 20px; line-height: 20px; width: 100%; overflow: auto"><div style="float:left; margin-left: 8px; font-size: 12px; width: 80%; overflow: auto">没有您的用药数据</div><div style="clear:both"></div></div>'),d.xAxis[0].setCategories(x),d.yAxis[0].update({min:0,max:200}),d.yAxis[1].update({min:0,max:200}),d.series[0].setData(y),d.series[1].setData(z),d.series[2].setData(A)}},error:function(){i.mobile.loading("hide"),j.toast("获取数据失败，请刷新界面")}})}console.info("home init"),l=[],i("#homepagecover").css("display","none"),i.mobile.loading("hide"),i("#nav-toggle").off("click"),i("#nav-toggle").on("click",function(){"none"==i("#ulistwraper").css("display")?(i(".triangle-border").css("display","inline-block"),i(".triangle-bg").css("display","inline-block"),i("#ulistwraper").slideDown("fast",function(){})):i("#ulistwraper").slideUp("fast",function(){i(".triangle-bg").css("display","none"),i(".triangle-border").css("display","none")})}),i("#ulistwraper").on("click",".uitem",function(){var a=i("#curuser").text();i(this).text()!==a&&(i.mobile.loading("show",{text:"页面加载中...",textVisible:!0,theme:"c",html:""}),b(i(this).attr("userid"),i(this).text())),i("#ulistwraper").css("display","none"),i(".triangle-bg").css("display","none"),i(".triangle-border").css("display","none")}),i("#todayDate").empty();var c=new Date;c=c.getFullYear()+"-"+(c.getMonth()+1)+"-"+c.getDate(),i("#todayDate").html(c);var d,f=1;e(1,0,0,0);var g=a("highcharts/4.0.3/highcharts-all"),h=a("highcharts/4.0.3/highchartsTheme").getGridThemeOption();g.setOptions(h),i("#medicationInfo").highcharts({chart:{type:"line",backgroundColor:"#f9f9f9"},title:{text:""},subtitle:{text:""},xAxis:{categories:["1日","2日","3日","4日","5日","6日","7日"]},yAxis:[{title:{text:"mmHg",margin:0},lineWidth:1},{title:{text:"次",margin:0},lineWidth:1,opposite:!0}],tooltip:{enabled:!0,formatter:function(){return"<b>"+this.series.name+"</b><br>"+this.x+": "+this.y}},plotOptions:{line:{dataLabels:{enabled:!0},enableMouseTracking:!1}},series:[{name:"舒张压",data:[90,90,90,90,90,90,90],yAxis:0},{name:"收缩压",data:[120,120,120,120,120,120,120],yAxis:0},{name:"心率",data:[80,80,80,80,80,80,80],yAxis:1}],credits:{enabled:!1}},function(a){d=a,f--,0==f&&b()})})}}),define("example/lehealth/common",["jquery-mobile/1.4.4/jquery.mobile"],function(a,b){function c(a){var b,c={};c.href=a;for(var d in e)b=e[d].exec(a),c[d]=b[1],a=b[2],""===a&&(a="/"),"pathname"===d&&(c.pathname=b[1],c.search=b[2],c.hash=b[3]);return c}var d=a("jquery-mobile/1.4.4/jquery.mobile");b.hideAddressBar=function(){};var e={protocol:/([^\/]+:)\/\/(.*)/i,host:/(^[^\:\/]+)((?:\/|:|$)?.*)/,port:/\:?([^\/]*)(\/?.*)/,pathname:/([^\?#]+)(\??[^#]*)(#?.*)/};b.getParams=function(a){var b=window.location.href,d=c(b).search;console.info("params:"+d);var e={};if(d)for(var f=d.split("&"),g=0;g<f.length;g++){var h=f[g].split("=");2==h.length&&(e[h[0]]=decodeURIComponent(h[1]))}return e[a]},b.getCookieByKey=function(a){var b=document.cookie.split("; "),c={};for(var d in b){var e=b[d].split("=");2==e.length&&(c[e[0]]=decodeURIComponent(e[1]))}return c[a]},b.setCookie=function(a,b){var c=new Date;c.setTime(c.getTime()+31536e6),document.cookie=a+"="+escape(b)+";expires="+c.toGMTString()},b.showDialog=function(a,b){d("#"+b+" .dialog_text").html("<p>"+a+"</p>"),d("#"+b+" .dialog").popup(),d("#"+b+" .dialog").popup("open")},b.dismissDialog=function(a){d("#"+a+" .dialog").popup("close")},b.toast=function(a){d("<div class='ui-loader ui-overlay-shadow ui-body-f ui-corner-all' style='background-color:#f9f9f9'><h3>"+a+"</h3></div>").css({display:"block",opacity:.9,position:"fixed",padding:"7px","text-align":"center",width:"270px",left:(d(window).width()-284)/2,top:d(window).height()/2-30}).appendTo(d.mobile.pageContainer).delay(1500).fadeOut(400,function(){d(this).remove()})},b.arrayEqual=function(a,b){if(!a||!b)return a||b?!1:!0;if(a.length==b.length){for(var c=0;c<a.length;c++){for(var d=!1,e=0;e<b.length;e++)a[c]==b[e]&&(d=!0);if(!d)return!1}return!0}return!1}});

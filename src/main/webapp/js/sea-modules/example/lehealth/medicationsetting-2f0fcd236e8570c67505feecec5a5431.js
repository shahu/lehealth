define("example/lehealth/medicationsetting",["jquery-mobile/1.4.4/jquery.mobile","./common"],function(a,b){var c=a("jquery-mobile/1.4.4/jquery.mobile"),d=a("./common"),e="/lehealth/api/medicines.do",f="/lehealth/api/medicine/setting/modify";b.render=function(){c(document).off("pageshow","#medicationsetting"),c(document).on("pageshow","#medicationsetting",function(){c("#medicationsettingcover").css("display","none"),c("#status_update").val(1),c("#datefrom").val(""),c(".dosage").val(""),c(".config").css("display","none"),c(".config").removeClass("show_config"),c("#config_1").css("display","block"),c("#config_1").addClass("show_config"),c("#config_count").val("1");for(var a=(d.getCookieByKey("loginid"),d.getCookieByKey("tk"),""),b=0;24>b;b++)10>b&&(b="0"+b),a+='<option value="'+b+'">'+b+"</option>";for(var g="",b=0;4>b;b++){var h=15*b;10>h&&(h="0"+h),g+='<option value="'+h+'">'+h+"</option>"}c.ajax({url:e,type:"GET",dataType:"json",async:!0,success:function(b){if(b.errorcode){if(1===b.errorcode)return d.toast("请重新登录"),void setTimeout(function(){c.mobile.changePage("/lehealth/login.html","slide")},1e3);d.toast("获取数据失败，请刷新界面")}else{for(var e=b.result,f="",h=0;h<e.length;h++){f+='<optgroup label="'+e[h].catename+'">';for(var i=e[h].medicines,j=0;j<i.length;j++)f+='<option value="'+i[j].id+'">'+i[j].name+"</option>";f+="</optgroup>"}c("#medacine").empty(),c("#medacine").html(f),c("#medacine").selectmenu("refresh"),c("select.time_hour").empty(),c("select.time_hour").html(a),c("select.time_hour").selectmenu("refresh"),c("select.time_minute").empty(),c("select.time_minute").html(g),c("select.time_minute").selectmenu("refresh")}},error:function(){d.toast("获取数据失败，请刷新界面")}}),c(".add_icon").off("click"),c(".add_icon").on("click",function(){var a=c("#config_count").val();if(a>10)return void alert("暂不支持更多时间");a++;for(var b=2;a>=b;b++)c("#config_"+b).css("display","block"),c("#config_"+b).addClass("show_config");c("#config_count").val(a)}),c(".del_icon").off("click"),c(".del_icon").on("click",function(){var a=c("#config_count").val();a--,c("#config_count").val(a),c(this).parent().parent().css("display","none"),c(this).parent().parent().removeClass("show_config")}),c("#config_update").off("click"),c("#config_update").on("click",function(){var a=c("#status_update").val();if(1==a){if(c("#status_update").val(0),0==c("#datefrom").val())return alert("请选择日期"),void c("#status_update").val(1);var b=d.getCookieByKey("loginid"),e=d.getCookieByKey("tk"),g=c("#medacine").val(),h=c("#datefrom").val().replace(/-/g,"/"),i=new Date(h),j=[],k=1;if(c.each(c(".show_config"),function(){if(c(this).find("input.dosage").val()>0&&""!=c(this).find("span.time_hour").text()&&""!=c(this).find("span.time_minute").text()){var a={};a.time=c(this).find("select.time_hour").val()+":"+c(this).find("select.time_minute").val(),a.dosage=c(this).find("input.dosage").val();for(var b=0,d=0;d<j.length;d++)j[d].time==a.time&&(b=1);0==b?j.push(a):k=2}else console.info(c(this).find("input.dosage").val()),console.info(c(this).find("span.time_hour").text()),console.info(c(this).find("span.time_minute").text()),k=0}),0==k)return alert("请填写正确的用药计划"),void c("#status_update").val(1);if(2==k)return alert("请勿填写重复时间的用药计划"),void c("#status_update").val(1);c.ajax({url:f,type:"POST",dataType:"json",async:!0,data:{loginid:b,token:e,medicineid:g,datefrom:i.getTime(),configs:JSON.stringify(j)},success:function(a){if(a.errorcode){if(1===a.errorcode)return d.toast("请重新登录"),void setTimeout(function(){c.mobile.changePage("/lehealth/login.html","slide")},1e3);d.toast("提交数据失败，请重新提交"),c("#status_update").val(1)}else c("#status_update").val(1),c("#datefrom").val(""),c(".dosage").val(""),c(".config").css("display","none"),c(".config").removeClass("show_config"),c("#config_1").css("display","block"),c("#config_1").addClass("show_config"),c("#config_count").val("1"),d.toast("提交成功"),setTimeout(function(){c.mobile.changePage("/lehealth/medicationconfig.html","slide")},1e3)},error:function(){d.toast("提交数据失败，请重新提交"),c("#status_update").val(1)}})}})})}}),define("example/lehealth/common",["jquery-mobile/1.4.4/jquery.mobile"],function(a,b){function c(a){var b,c={};c.href=a;for(var d in e)b=e[d].exec(a),c[d]=b[1],a=b[2],""===a&&(a="/"),"pathname"===d&&(c.pathname=b[1],c.search=b[2],c.hash=b[3]);return c}var d=a("jquery-mobile/1.4.4/jquery.mobile");b.hideAddressBar=function(){};var e={protocol:/([^\/]+:)\/\/(.*)/i,host:/(^[^\:\/]+)((?:\/|:|$)?.*)/,port:/\:?([^\/]*)(\/?.*)/,pathname:/([^\?#]+)(\??[^#]*)(#?.*)/};b.getParams=function(a){var b=window.location.href,d=c(b).search;console.info("params:"+d);var e={};if(d)for(var f=d.split("&"),g=0;g<f.length;g++){var h=f[g].split("=");2==h.length&&(e[h[0]]=decodeURIComponent(h[1]))}return e[a]},b.getCookieByKey=function(a){var b=document.cookie.split("; "),c={};for(var d in b){var e=b[d].split("=");2==e.length&&(c[e[0]]=decodeURIComponent(e[1]))}return c[a]},b.setCookie=function(a,b){var c=new Date;c.setTime(c.getTime()+31536e6),document.cookie=a+"="+escape(b)+";expires="+c.toGMTString()},b.showDialog=function(a,b){d("#"+b+" .dialog_text").html("<p>"+a+"</p>"),d("#"+b+" .dialog").popup(),d("#"+b+" .dialog").popup("open")},b.dismissDialog=function(a){d("#"+a+" .dialog").popup("close")},b.toast=function(a){d("<div class='ui-loader ui-overlay-shadow ui-body-f ui-corner-all' style='background-color:#f9f9f9'><h3>"+a+"</h3></div>").css({display:"block",opacity:.9,position:"fixed",padding:"7px","text-align":"center",width:"270px",left:(d(window).width()-284)/2,top:d(window).height()/2-30}).appendTo(d.mobile.pageContainer).delay(1500).fadeOut(400,function(){d(this).remove()})},b.arrayEqual=function(a,b){if(!a||!b)return a||b?!1:!0;if(a.length==b.length){for(var c=0;c<a.length;c++){for(var d=!1,e=0;e<b.length;e++)a[c]==b[e]&&(d=!0);if(!d)return!1}return!0}return!1}});
